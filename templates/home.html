<!doctype html>
<html>
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Resume Personalizer</title>
		<link
			rel="stylesheet"
			href="{{url_for('static', filename='website.css')}}"
		/>
		<link rel="preconnect" href="https://fonts.googleapis.com" />
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
		<link
			href="https://fonts.googleapis.com/css2?family=Josefin+Sans:ital,wght@0,100..700;1,100..700&display=swap"
			rel="stylesheet"
		/>
	</head>

	<body>
		<div class="aIRC aICC bB h-100 d-f">
			<div class="t-XXL t-cen">Resume Personalizer</div>
			<div class="t-XS mt-1em">Generate a personalized resume today</div>
			<div class="btn-hold d-f">
				<button class="btn mr-1em pR-1em pL-1em" id="NewResume">
					New Resume
					<img
						class="w-2-5em"
						src="{{url_for('static', filename='images/NewResume.svg')}}"
						\
					/>
				</button>
				<button class="btn pR-1em pL-1e" id="BrowseProfiles">
					Profiles
					<img
						class="w-2-5em"
						src="{{url_for('static', filename='images/Profile.svg')}}"
						\
					/>
				</button>
			</div>
			<div
				class="d-h aICC aIRC p-f bg-tb w-100vw h-100vh"
				id="hiddenOverlayProfile"
			>
				<div class="w-100 h-100 p-abs bBl-5px" id="blurOverlayProfile"></div>
				<div class="profileSelection" id="profileSelection">
					<div class="aIRE mr-1em d-f">
						<button class="btn bR-02em mt-1em bg-g" id="CloseOverlayProfile">
							<img
								class="w-2em"
								src="{{url_for('static', filename='images/Close.svg')}}"
							/>
						</button>
					</div>
					<div class="t-L bAICC">Select a Profile</div>
					<div id="noProfiles" class="d-h">
						<div class="t-M mt-3em aICC">No Profiles Created Yet</div>
						<div class="t-XS aICC mt-1em">
							Create a Profile to generate a resume
						</div>
						<div class="aIRC mt-3em mb-2em d-f">
							<button class="btn" id="CreateProfile">
								Create New Profile
								<img
									class="w-2-5em"
									src="{{url_for('static', filename='images/Profile.svg')}}"
								/>
							</button>
						</div>
					</div>
					<div id="profiles" class="d-f bAICC">
						<select
							class="mt-4em listDropdown"
							name="profileName"
							id="profilesList"
							form="form"
						></select>
						<div class="aIRC mt-4em mb-2em d-f">
							<button class="btn" id="Continue">
								Continue
								<img
									class="w-2-5em"
									src="{{url_for('static', filename='images/Submit.svg')}}"
								/>
							</button>
						</div>
					</div>
				</div>
			</div>
			<div
				class="aICC aIRC d-h p-f bg-tb w-100vw h-100vh"
				id="hiddenOverlayJob"
			>
				<div class="w-100 h-100 bBl-5px p-abs" id="blurOverlayJob"></div>
				<div class="jobDescSelection" id="jobDetails">
					<div class="aIRE mr-1em d-f">
						<button class="btn bR-02em mt-1em bg-g mr-1em" id="GoBack">
							<img
								class="w-2em"
								src="{{url_for('static', filename='images/Back.svg')}}"
							/>
						</button>
						<button class="btn bR-0.2em mt-1em bg-g" id="CloseOverlayJob">
							<img
								class="w-2em"
								src="{{url_for('static', filename='images/Close.svg')}}"
							/>
						</button>
					</div>
					<div class="t-L bAICC">Job Details</div>
					<div class="bAICC t-XS mt-1em">
						Enter full job description with requirements here
					</div>
					<form id="form" class="mt-4em bAICC">
						<textarea
							name="jobDesc"
							,
							id="jobDesc"
							class="jobDesc"
							cols="50"
							,
							rows="10"
						>
Paste Job Description & Requirements here</textarea
						>
						<div class="aIRC mt-3em mb-2em d-f">
							<button class="btn" id="Submit">
								Submit
								<img
									class="w-2-5em"
									src="{{url_for('static', filename='images/Submit.svg')}}"
								/>
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
	</body>
	<script text="text/javascript">
		document.getElementById("BrowseProfiles").addEventListener("click", () => {
			location.href = "/profiles";
		});
		document.getElementById("CreateProfile").addEventListener("click", () => {
			location.href = "/profiles";
		});

		var hiddenOverlayJob = document.getElementById("hiddenOverlayJob");
		var jobDetails = document.getElementById("jobDetails");
		var blurOverlayJob = document.getElementById("blurOverlayJob");

		document.getElementById("Continue").addEventListener("click", () => {
			hiddenOverlayProfile.style.display = "none";

			hiddenOverlayJob.classList.remove("fadeBackgroundOut");
			jobDetails.classList.remove("fadeOpacityOut");
			blurOverlayJob.classList.remove("fadeBlurOut");

			hiddenOverlayJob.style.display = "flex";
		});

		document.getElementById("CloseOverlayJob").addEventListener("click", () => {
			hiddenOverlayJob.classList.remove("fadeBackgroundIn");
			jobDetails.classList.remove("fadeOpacityIn");
			blurOverlayJob.classList.remove("fadeBlurIn");

			void blurOverlayJob.offsetWidth;
			void jobDetails.offsetWidth;
			void hiddenOverlayJob.offsetWidth;

			hiddenOverlayJob.classList.add("fadeBackgroundOut");
			jobDetails.classList.add("fadeOpacityOut");
			blurOverlayJob.classList.add("fadeBlurOut");
		});
		hiddenOverlayJob.addEventListener("animationend", (event) => {
			if (hiddenOverlayJob.classList.contains("fadeBackgroundOut")) {
				hiddenOverlayJob.style.display = "none";
			}
		});

		var hiddenOverlayProfile = document.getElementById("hiddenOverlayProfile");
		var profileSelection = document.getElementById("profileSelection");
		var blurOverlayProfile = document.getElementById("blurOverlayProfile");

		document.getElementById("NewResume").addEventListener("click", () => {
			hiddenOverlayProfile.classList.remove("fadeBackgroundOut");
			profileSelection.classList.remove("fadeOpacityOut");
			blurOverlayProfile.classList.remove("fadeBlurOut");

			void blurOverlayProfile.offsetWidth;
			void profileSelection.offsetWidth;
			void hiddenOverlayProfile.offsetWidth;

			hiddenOverlayProfile.classList.add("fadeBackgroundIn");
			profileSelection.classList.add("fadeOpacityIn");
			blurOverlayProfile.classList.add("fadeBlurIn");

			hiddenOverlayProfile.style.display = "flex";
		});
		var goBack = document.getElementById("GoBack");
		goBack.addEventListener("click", (e) => {
			e.preventDefault();

			hiddenOverlayJob.classList.remove("fadeBackgroundIn");
			jobDetails.classList.remove("fadeOpacityIn");
			blurOverlayJob.classList.remove("fadeBlurIn");

			hiddenOverlayJob.classList.add("fadeBackgroundOut");
			jobDetails.classList.add("fadeOpacityOut");
			blurOverlayJob.classList.add("fadeBlurOut");
			hiddenOverlayJob.style.display = "none";

			hiddenOverlayProfile.classList.remove("fadeBackgroundOut");
			profileSelection.classList.remove("fadeOpacityOut");
			blurOverlayProfile.classList.remove("fadeBlurOut");

			hiddenOverlayProfile.classList.remove("fadeBackgroundIn");
			profileSelection.classList.remove("fadeOpacityIn");
			blurOverlayProfile.classList.remove("fadeBlurIn");

			hiddenOverlayProfile.style.display = "flex";
		});
		document
			.getElementById("CloseOverlayProfile")
			.addEventListener("click", () => {
				hiddenOverlayProfile.classList.remove("fadeBackgroundIn");
				profileSelection.classList.remove("fadeOpacityIn");
				blurOverlayProfile.classList.remove("fadeBlurIn");

				void blurOverlayProfile.offsetWidth;
				void profileSelection.offsetWidth;
				void hiddenOverlayProfile.offsetWidth;

				hiddenOverlayProfile.classList.add("fadeBackgroundOut");
				profileSelection.classList.add("fadeOpacityOut");
				blurOverlayProfile.classList.add("fadeBlurOut");
			});

		hiddenOverlayProfile.addEventListener("animationend", (event) => {
			if (hiddenOverlayProfile.classList.contains("fadeBackgroundOut")) {
				hiddenOverlayProfile.style.display = "none";
			}
		});

		let numItems = localStorage.length;
		const noProfiles = document.getElementById("noProfiles");
		const profiles = document.getElementById("profiles");
		var profilesList = document.getElementById("profilesList");

		if (numItems > 0) {
			noProfiles.classList.remove("d-b");
			noProfiles.classList.add("d-h");
			profiles.classList.remove("d-h");
			profiles.classList.add("d-b");
			for (let i = 0; i < numItems; i++) {
				let option = document.createElement("option");
				let profileName = localStorage.key(i).split("|")[0];
				option.textContent = profileName;
				profilesList.appendChild(option);
			}
		} else {
			noProfiles.classList.remove("d-h");
			noProfiles.classList.add("d-b");
			profiles.classList.remove("d-b");
			profiles.classList.add("d-h");
		}

		document.getElementById("Submit").addEventListener("click", (e) => {
			e.preventDefault();
			const formData = new FormData(document.getElementById("form"));
			var profileName = formData.get("profileName");
			var profileData;
			for (var i = 0; i < localStorage.length; i++) {
				var lsProfileName = localStorage.key(i);
				if (lsProfileName.split("|")[0] == profileName) {
					profileData = localStorage.getItem(lsProfileName);
					break;
				}
			}
			formData.append("profile", profileData);
			for (const entry of formData.entries()) {
				console.log(entry[0] + " " + entry[1]);
			}
			document.getElementById("CloseOverlayJob").click();

			fetch("/submit", {
				method: "POST",
				body: formData,
			}).then((res) => {
				res.blob().then((blob) => {
					const url = window.URL.createObjectURL(blob);
					const temp = document.createElement("a");
					temp.href = url;
					temp.download = "Resume";
					document.body.appendChild(temp);
					temp.click();
					temp.remove();
					URL.revokeObjectURL(url);
					//Do other stuff here probably
				});
			});
		});
	</script>
</html>

